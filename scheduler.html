<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0f0c29">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>AION Retail EU - Schedule</title>
    <link rel="shortcut icon" href="https://assets.playnccdn.com/common/aion.ico" type="image/x-icon">
    <link rel="icon" href="https://assets.playnccdn.com/common/aion.ico" type="image/x-icon">
    <link rel="apple-touch-icon" href="https://assets.playnccdn.com/common/aion.ico">
    <link rel="stylesheet" href="assets/css/aion-tools.css?v=2.3">
</head>
<body class="page-scheduler">
    <a href="aion.html" class="home-button">üè† Tools Hub</a>
    <div class="container">
        <h1>AION Retail EU - Schedule</h1>
        
        <div class="time-display-section">
            <div class="time-box server-time">
                <div class="time-label">Server Time (UTC+1)</div>
                <div class="time-value" id="serverTime">--:--:--</div>
                <div class="time-date" id="serverDate">--</div>
            </div>
            <div class="time-box local-time">
                <div class="time-label">Your Local Time</div>
                <div class="time-value" id="localTime">--:--:--</div>
                <div class="time-date" id="localDate">--</div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-item active" data-event-type="dumaha">
                <div class="legend-color dumaha-altar"></div>
                <span>Dumaha Altar</span>
            </div>
            <div class="legend-item active" data-event-type="mastarius">
                <div class="legend-color mastarius-veille"></div>
                <span>Mastarius/Veille</span>
            </div>
            <div class="legend-item active" data-event-type="fortress">
                <div class="legend-color fortress"></div>
                <span>Fortress Siege</span>
            </div>
            <div class="legend-item active" data-event-type="arena">
                <div class="legend-color arena-chaos"></div>
                <span>Arena of Chaos</span>
            </div>
        </div>

        <div class="next-event-section">
            <div class="next-event-title">‚è≥ Time until next event:</div>
            <div class="next-event-info" id="nextEventInfo">Calculating...</div>
        </div>

        <div class="scheduler-grid-wrapper">
            <div class="scheduler-header">
                <div class="day-header">Local Time</div>
                <div class="day-header" data-day="0">Monday</div>
                <div class="day-header" data-day="1">Tuesday</div>
                <div class="day-header" data-day="2">Wednesday</div>
                <div class="day-header" data-day="3">Thursday</div>
                <div class="day-header" data-day="4">Friday</div>
                <div class="day-header" data-day="5">Saturday</div>
                <div class="day-header" data-day="6">Sunday</div>
            </div>

            <div class="scheduler-grid" id="schedulerGrid">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="footer-actions">
            <a href="https://discordapp.com/users/158658357606088704" target="_blank" class="discord-button">
                <svg class="discord-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.216-1.975a.076.076 0 0 0-.042-.106a13.107 13.107 0 0 1-1.873-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.294a.074.074 0 0 1 .076-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.294a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.963 19.963 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-4.467.072-8.339-2.115-11.769a.06.06 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-.965-2.157-2.156c0-1.193.964-2.157 2.157-2.157c1.193 0 2.156.964 2.157 2.157c0 1.19-.964 2.156-2.157 2.156zm7.975 0c-1.183 0-2.157-.965-2.157-2.156c0-1.193.965-2.157 2.157-2.157c1.192 0 2.156.964 2.157 2.157c0 1.19-.965 2.156-2.157 2.156z"/>
                </svg>
                Support & Feedback
            </a>
        </div>

        <div class="copyright">
            ¬© <span id="copyright-year"></span> <a href="myAionProfiles.html"><strong>15TAN</strong></a> - AION Retail EU Schedule
        </div>

        <div class="disclaimer">
            This website is a non-commercial fan project. AION and all related images/assets are trademarks or registered trademarks of NCSoft Corporation and Gameforge. All rights reserved.
        </div>
    </div>

    <script>
        // Events schedule (server time in 24-hour format)
        const events = [
            // Dumaha Altar
            { name: 'Dumaha Altar', type: 'dumaha', days: [0, 2, 4, 6], times: ['14:00', '20:00'] },
            // Mastarius/Veille
            { name: 'Mastarius/Veille', type: 'mastarius', days: [1, 4, 5], times: ['13:00', '22:00'] },
            // Fortress Sieges
            { name: 'Inggison + Gelkmaros + Core', type: 'fortress', days: [3, 6], times: ['21:00'] },
            { name: 'Bassen', type: 'fortress', days: [3], times: ['22:00'] },
            { name: 'Prades', type: 'fortress', days: [6], times: ['22:00'] },
            // Arena of Chaos
            { name: 'Arena of Chaos', type: 'arena', days: [0, 2, 4, 6], times: ['12:00', '19:00', '00:00'] }
        ];

        // Get current server time (UTC+1)
        function getServerTime() {
            const now = new Date();
            // getTimezoneOffset() returns minutes BEHIND UTC (negative for ahead)
            // For UTC+2: returns -120 (120 minutes ahead)
            // Server is UTC+1, so we need to adjust by the difference
            const localOffsetMs = now.getTimezoneOffset() * 60 * 1000;
            const serverOffsetMs = -60 * 60 * 1000; // UTC+1
            const adjustmentMs = localOffsetMs - serverOffsetMs;
            const serverTime = new Date(now.getTime() + adjustmentMs);
            return serverTime;
        }

        function formatTime(hours, minutes, seconds = 0, includeSeconds = true) {
            if (includeSeconds) {
                return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            }
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
        }

        function formatDate(year, month, day) {
            return `${String(day).padStart(2, '0')}.${String(month).padStart(2, '0')}.${year}`;
        }

        function updateTimeDisplays() {
            const now = new Date();
            const serverTime = getServerTime();
            
            const serverHours = String(serverTime.getHours()).padStart(2, '0');
            const serverMinutes = String(serverTime.getMinutes()).padStart(2, '0');
            const serverSeconds = String(serverTime.getSeconds()).padStart(2, '0');
            const serverDay = String(serverTime.getDate()).padStart(2, '0');
            const serverMonth = String(serverTime.getMonth() + 1).padStart(2, '0');
            const serverYear = serverTime.getFullYear();

            document.getElementById('serverTime').textContent = `${serverHours}:${serverMinutes}:${serverSeconds}`;
            document.getElementById('serverDate').textContent = `${serverDay}.${serverMonth}.${serverYear}`;

            // Local time
            const localHours = String(now.getHours()).padStart(2, '0');
            const localMinutes = String(now.getMinutes()).padStart(2, '0');
            const localSeconds = String(now.getSeconds()).padStart(2, '0');
            const localDay = String(now.getDate()).padStart(2, '0');
            const localMonth = String(now.getMonth() + 1).padStart(2, '0');
            const localYear = now.getFullYear();

            document.getElementById('localTime').textContent = `${localHours}:${localMinutes}:${localSeconds}`;
            document.getElementById('localDate').textContent = `${localDay}.${localMonth}.${localYear}`;

            updateNextEvent();
        }

        function getNextEvent() {
            const now = new Date();
            const currentHours = now.getHours();
            const currentMinutes = now.getMinutes();
            const currentDayOfWeek = now.getDay() === 0 ? 6 : now.getDay() - 1; // Sunday = 6, Monday = 0
            const currentTimeInMinutes = currentHours * 60 + currentMinutes;

            let nextEvent = null;
            let minWait = Infinity;

            for (let event of events) {
                for (let day of event.days) {
                    for (let timeStr of event.times) {
                        // Convert server time event to local time
                        const [serverHour, serverMinute] = timeStr.split(':').map(Number);
                        const { hour: localHour, dayOffset } = convertServerTimeToLocal(serverHour, serverMinute);
                        const eventMinutes = Math.floor(localHour) * 60 + serverMinute;
                        
                        // Adjust day if timezone conversion caused day shift
                        let eventDay = day + dayOffset;
                        if (eventDay < 0) eventDay += 7;
                        if (eventDay >= 7) eventDay -= 7;
                        
                        let waitMinutes = 0;

                        if (eventDay === currentDayOfWeek && eventMinutes > currentTimeInMinutes) {
                            waitMinutes = eventMinutes - currentTimeInMinutes;
                        } else if (eventDay > currentDayOfWeek) {
                            const daysToAdd = eventDay - currentDayOfWeek;
                            waitMinutes = (daysToAdd * 24 * 60) + (eventMinutes - currentTimeInMinutes);
                        } else {
                            const daysToAdd = 7 - currentDayOfWeek + eventDay;
                            waitMinutes = (daysToAdd * 24 * 60) + (eventMinutes - currentTimeInMinutes);
                        }

                        if (waitMinutes >= 0 && waitMinutes < minWait) {
                            minWait = waitMinutes;
                            nextEvent = { ...event, waitMinutes };
                        }
                    }
                }
            }

            return nextEvent;
        }

        function updateNextEvent() {
            const nextEvent = getNextEvent();
            const infoDiv = document.getElementById('nextEventInfo');

            if (nextEvent) {
                const hours = Math.floor(nextEvent.waitMinutes / 60);
                const minutes = Math.floor(nextEvent.waitMinutes % 60);
                const seconds = 60 - new Date().getSeconds();

                let timeStr = '';
                if (hours > 0) {
                    timeStr = `${hours}h ${minutes}m ${seconds}s`;
                } else {
                    timeStr = `${minutes}m ${seconds}s`;
                }

                infoDiv.textContent = `${nextEvent.name} - ${timeStr}`;
                infoDiv.style.color = getEventColor(nextEvent.type);
            }
        }

        function getEventColor(type) {
            const colors = {
                'dumaha': '#c49c3a',
                'mastarius': '#42a5f5',
                'fortress': '#ef5350',
                'arena': '#ab47bc'
            };
            return colors[type] || '#fff';
        }

        function convertServerTimeToLocal(serverHour, serverMinute) {
            // Get local timezone offset
            const now = new Date();
            const localOffsetHours = -now.getTimezoneOffset() / 60;
            const timezoneDiffHours = localOffsetHours - 1; // Server is UTC+1
            
            let localHour = serverHour + timezoneDiffHours;
            let dayOffset = 0;
            
            if (localHour >= 24) {
                localHour -= 24;
                dayOffset = 1;
            } else if (localHour < 0) {
                localHour += 24;
                dayOffset = -1;
            }
            
            return { hour: localHour, dayOffset: dayOffset };
        }

        function shortenEventName(eventName) {
            const shortNames = {
                'Dumaha Altar': 'D. Altar',
                'Mastarius/Veille': 'Mast. Veille',
                'Inggison + Gelkmaros + Core': 'Siege',
                'Bassen': 'Siege',
                'Prades': 'Siege',
                'Arena of Chaos': 'Chaos'
            };
            return shortNames[eventName] || eventName;
        }

        function createSchedulerGrid() {
            const grid = document.getElementById('schedulerGrid');
            grid.innerHTML = '';
            
            const now = new Date();
            const currentHour = now.getHours();

            // Get all unique local hours that have events
            const hoursWithEvents = new Set();
            events.forEach(event => {
                event.times.forEach(timeStr => {
                    const [serverHour, serverMinute] = timeStr.split(':').map(Number);
                    const { hour: localHour } = convertServerTimeToLocal(serverHour, serverMinute);
                    hoursWithEvents.add(localHour);
                });
            });

            // Create rows for all 24 hours
            for (let localHour = 0; localHour < 24; localHour++) {
                const hasEvents = hoursWithEvents.has(localHour);
                const isCurrentHour = localHour === currentHour;
                
                const hourLabel = document.createElement('div');
                hourLabel.className = 'hour-label';
                hourLabel.dataset.hour = localHour;
                if (!hasEvents) {
                    hourLabel.classList.add('hour-label-empty');
                }
                if (isCurrentHour) {
                    hourLabel.classList.add('current-hour-label');
                }
                hourLabel.textContent = String(localHour).padStart(2, '0') + ':00';
                grid.appendChild(hourLabel);

                // Create 7 columns for days of week
                for (let day = 0; day < 7; day++) {
                    const cell = document.createElement('div');
                    cell.className = 'scheduler-cell';
                    cell.dataset.day = day;
                    cell.dataset.hour = localHour;
                    if (!hasEvents) {
                        cell.classList.add('scheduler-cell-empty');
                    }
                    if (isCurrentHour) {
                        cell.classList.add('current-hour-cell');
                    }

                    // Check for events at this local hour and day
                    const eventsAtThisTime = events.filter(e => {
                        if (!e.days.includes(day)) return false;
                        return e.times.some(t => {
                            const [serverHour, serverMinute] = t.split(':').map(Number);
                            const { hour: eventLocalHour } = convertServerTimeToLocal(serverHour, serverMinute);
                            return eventLocalHour === localHour;
                        });
                    });

                    if (eventsAtThisTime.length > 0) {
                        const eventDiv = document.createElement('div');
                        eventDiv.className = `scheduler-event event-${eventsAtThisTime[0].type}`;
                        
                        const eventNames = eventsAtThisTime.map(e => e.name).join(' + ');
                        const isMobile = window.innerWidth <= 768;
                        const displayName = isMobile ? shortenEventName(eventsAtThisTime[0].name) : eventsAtThisTime[0].name;
                        eventDiv.innerHTML = `<span class="event-label">${displayName}</span>`;
                        eventDiv.title = eventNames;
                        
                        cell.appendChild(eventDiv);
                    }

                    grid.appendChild(cell);
                }
            }

            // Auto-scroll to current hour after a brief delay to ensure DOM is ready
            setTimeout(() => {
                const schedulerWrapper = document.querySelector('.scheduler-grid-wrapper');
                const currentHourLabel = document.querySelector(`[data-hour="${currentHour}"].hour-label`);
                if (schedulerWrapper && currentHourLabel) {
                    // Scroll so the current hour is at the top with some offset
                    schedulerWrapper.scrollTop = currentHourLabel.offsetTop - 100;
                }
            }, 50);
        }

        function setupLegendFilters() {
            document.querySelectorAll('.legend-item').forEach(item => {
                item.addEventListener('click', function() {
                    this.classList.toggle('active');
                    const eventType = this.dataset.eventType;
                    
                    document.querySelectorAll(`.scheduler-event.event-${eventType}`).forEach(event => {
                        event.parentElement.style.opacity = this.classList.contains('active') ? '1' : '0.3';
                    });
                });
            });
        }

        function updateNowHighlight() {
            const now = new Date();
            let currentDayOfWeek = now.getDay() === 0 ? 6 : now.getDay() - 1;
            
            // Remove previous day header highlights
            document.querySelectorAll('.day-header.today').forEach(header => {
                header.classList.remove('today');
            });
            
            // Highlight only the current day header
            const todayHeader = document.querySelector(`.day-header[data-day="${currentDayOfWeek}"]`);
            if (todayHeader) {
                todayHeader.classList.add('today');
            }
        }

        // Initialize
        window.addEventListener('load', () => {
            createSchedulerGrid();
            setupLegendFilters();
            updateTimeDisplays();
            updateNowHighlight();
            setInterval(() => {
                updateTimeDisplays();
                updateNowHighlight();
            }, 1000);
            document.getElementById('copyright-year').textContent = new Date().getFullYear();
        });
    </script>
</body>
</html>